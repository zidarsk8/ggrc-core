{{!
  Copyright (C) 2017 Google Inc.
  Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
}}
{{!
    Copyright (C) 2017 Google Inc., authors, and contributors
    Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
}}

<div class="flex-box">
  <related-people-access-control
    class="width-100"
    {info-pane-mode}="infoPaneMode"
    {is-new-instance}="isNewInstance"
    {instance}="instance">
      <div class="people-groups">
        {{#groups}}
          <related-people-access-control-group
            {info-pane-mode}="infoPaneMode"
            (add-role)="addPerson(%event)"
            (remove-role)="removePerson(%event)"
            (save-roles)="saveRoles(%event)"
            {required}="required"
            {group-id}="groupId"
            {title}="title"
            {people}="people"
            {instance}="instance"
            class="people-group"
            {updatable-group-id}="updatableGroupId"
          >
          <div>
            {{#if infoPaneMode}}
              <editable-people-group
                {required}="required"
                (unmap)="removePerson(%event)"
                (change-editable-mode)="changeEditableGroup(%event)"
                (save-changes)="saveChanges()"
                (person-selected)="personSelected(%event)"
                {editable-mode}="editableMode"
                {can-unmap}="canEdit"
                {can-edit}="canEdit"
                {is-loading}="isLoading"
                {group-id}="groupId"
                {instance}="instance"
                {title}="title"
                {people}="people">
              </editable-people-group>
            {{else}}
              <deletable-people-group
                show-empty-message="false"
                {required}="required"
                (unmap)="removePerson(%event)"
                {can-unmap}="canEdit"
                {is-loading}="isLoading"
                {group-id}="groupId"
                {instance}="instance"
                {people}="people">
                <label class="people-group__title form-label required-label">
                  {{title}}
                  {{#if required}}
                    <i class="fa fa-asterisk"></i>
                  {{/if}}
                </label>
              </deletable-people-group>
              <div>
                {{#if isUpdating}}
                  <spinner {toggle}="isUpdating"></spinner>
                {{else}}
                  {{#is_allowed 'update' instance}}
                    <autocomplete
                        search-items-type="Person"
                        (item-selected)="addPerson(%event.selectedItem, @groupId)"
                        placeholder="Add person">
                    </autocomplete>
                  {{/is_allowed}}
                {{/if}}
              </div>
            {{/if}}
          </div>
          </related-people-access-control-group>
        {{/groups}}
      </div>
  </related-people-access-control>
</div>
